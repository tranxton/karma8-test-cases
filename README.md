# Tech Lead PHP Test Cases

## Задача 1
Вы разрабатываете сервис для рассылки уведомлений об истекающих подписках.
За один и за три дня до истечения срока подписки, нужно отправить письмо пользователю с текстом "{username}, your subscription is expiring soon".

Условия:

1. Таблица в DB с пользователями (5 000 000+ строк):
2. Около 80% пользователей не имеют подписки.
3. Только 15% пользователей подтверждают свой емейл (поле confirmed).
4. Внешняя функция check_email( $email )
   Проверяет емейл на валидность (на валидный емейл письмо точно дойдёт) и возвращает 0 или 1. Функция работает от 1 секунды до 1 минуты. Вызов функции стоит 1 руб.
5. Функция send_email( $from, $to, $text )
   Отсылает емейл. Функция работает от 1 секунды до 10 секунд.

| Наименование | Описание                                                                                                                                                                                                                                |
|:-------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| username     | Имя пользователя                                                                                                                                                                                                                        |
| email        | Емейл                                                                                                                                                                                                                                   |
| validts      | Unix timestamp до которого действует ежемесячная подписка, либо 0 если подписки нет                                                                                                                                                     |
| confirmed    | 0 или 1 в зависимости от того, подтвердил ли пользователь свой емейл по ссылке (пользователю после регистрации приходит письмо с уникальный ссылкой на указанный емейл, если он нажал на ссылку в емейле в этом поле устанавливается 1) |
| checked      | Была ли проверка емейла на валидацию (1) или не было (0)                                                                                                                                                                                |
| valid        | Является ли емейл валидным (1) или нет (0)                                                                                                                                                                                              |

Ограничения:
1. Необходимо регулярно отправлять емейлы об истечении срока подписки на те емейлы, на которые письмо точно дойдёт
2. Можно использовать cron
3. Можно создать необходимые таблицы в DB или изменить
   существующие
4. Для функций check_email и send_email нужно написать "заглушки"
5. Не использовать ООП
6. Очереди реализовать без использования менеджеров 

Преимуществом будет:
1. Простой, читаемый и рабочий код 
2. Readme

Этим заданием мы хотим понять образ вашего мышления и умение найти подход к решению задач. Не стоит демонстрировать разнообразие технологий, которыми вы владеете. Код должен быть простым и решать поставленную задачу из тестового задания.

##  Задача 2
Есть 3 таблицы:
- Пользователи 
  - id
  - username 
- Заказы (один пользователь может иметь несколько заказов, как оплаченных, так и нет)
  - id
  - user_id
  - amount
  - payed 
- Платежи (один заказ может содержать несколько платежей, как успешных, так и нет)
  - id
  - order_id
  - amount
  - pay_system
  - status
  
Напишите запрос выбирающий пользователей у которых соотношение оплаченных заказов к неоплаченным больше 2, при этом количество неуспешных платежей по всем заказам пользователя меньше 15%.

## Задача 3

Вы разрабатываете сервис позволяющий пользователям качать фильмы с торрентов на облачное хранилище и впоследствии смотреть их из него. Соответственно пользователь может добавить торрент, и в зависимости от загрузки и тарифа пользователя мы его качаем.
Предложите диаграмму (схему) сервисов, которая легко масштабируема и позволит обслуживать несколько миллионов пользователей.
Будем признательны, если вы разместите код в GitHub.
